C:\Users\lucev\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:247: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-8.3.3, pluggy-1.6.0 -- C:\Users\lucev\AppData\Local\Microsoft\WindowsApps\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\lucev\Downloads\Turnover Program General\Turnover Program v4
configfile: pyproject.toml
plugins: anyio-4.8.0, dash-2.18.2, Faker-38.2.0, jaxtyping-0.3.4, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 14 items

test_api.py::TestHealthEndpoints::test_root_endpoint PASSED              [  7%]
test_api.py::TestHealthEndpoints::test_health_endpoint PASSED            [ 14%]
test_api.py::TestHealthEndpoints::test_api_info_endpoint PASSED          [ 21%]
test_api.py::TestTrainingEndpoints::test_train_status_unauthenticated PASSED [ 28%]
test_api.py::TestTrainingEndpoints::test_train_requires_auth Training Progress: 20% - Training one year model...
Training Progress: 20% - One Year: Starting Individual Model...
Training Progress: 24% - One Year: Data loaded and preprocessed
Training Progress: 28% - One Year: Selecting features...
Training Progress: 36% - One Year: Features selected
Training Progress: 40% - One Year: Optimizing hyperparameters...
Fitting 5 folds for each of 20 candidates, totalling 100 fits
FAILED      [ 35%]
test_api.py::TestTrainingEndpoints::test_train_with_auth ERROR           [ 42%]
test_api.py::TestPredictionEndpoints::test_individual_prediction_requires_auth FAILED [ 50%]
test_api.py::TestPredictionEndpoints::test_aggregate_prediction_requires_auth FAILED [ 57%]
test_api.py::TestPredictionEndpoints::test_individual_prediction_with_auth ERROR [ 64%]
test_api.py::TestBayesianEndpoints::test_bayesian_train_status PASSED    [ 71%]
test_api.py::TestBayesianEndpoints::test_bayesian_train_requires_auth FAILED [ 78%]
test_api.py::TestBayesianEndpoints::test_bayesian_individual_requires_auth FAILED [ 85%]
test_api.py::TestBayesianEndpoints::test_bayesian_aggregate_requires_auth FAILED [ 92%]
test_api.py::TestDashboardEndpoint::test_dashboard_data_loads PASSED     [100%]

=================================== ERRORS ====================================
________ ERROR at setup of TestTrainingEndpoints.test_train_with_auth _________
file C:\Users\lucev\Downloads\Turnover Program General\Turnover Program v4\backend\tests\test_api.py, line 53
      def test_train_with_auth(self, client, mock_auth):
E       fixture 'mock_auth' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_faker, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, client, cov, dash_br, dash_duo, dash_duo_mp, dash_multi_process_server, dash_process_server, dash_thread_server, dashjl, dashjl_server, dashr, dashr_server, diskcache_manager, doctest_namespace, event_loop_policy, faker, mock_env_vars, mock_model_loaded, monkeypatch, no_cover, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_df, sample_employee_data, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\lucev\Downloads\Turnover Program General\Turnover Program v4\backend\tests\test_api.py:53
_ ERROR at setup of TestPredictionEndpoints.test_individual_prediction_with_auth _
file C:\Users\lucev\Downloads\Turnover Program General\Turnover Program v4\backend\tests\test_api.py, line 80
      def test_individual_prediction_with_auth(self, client, mock_auth, sample_df):
E       fixture 'mock_auth' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_faker, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, client, cov, dash_br, dash_duo, dash_duo_mp, dash_multi_process_server, dash_process_server, dash_thread_server, dashjl, dashjl_server, dashr, dashr_server, diskcache_manager, doctest_namespace, event_loop_policy, faker, mock_env_vars, mock_model_loaded, monkeypatch, no_cover, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_df, sample_employee_data, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\lucev\Downloads\Turnover Program General\Turnover Program v4\backend\tests\test_api.py:80
================================== FAILURES ===================================
_______________ TestTrainingEndpoints.test_train_requires_auth ________________
test_api.py:51: in test_train_requires_auth
    assert response.status_code == 401
E   assert 200 == 401
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout call -----------------------------
Training Progress: 5% - Generating synthetic data...
______ TestPredictionEndpoints.test_individual_prediction_requires_auth _______
test_api.py:70: in test_individual_prediction_requires_auth
    assert response.status_code == 401
E   assert 500 == 401
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout call -----------------------------
Prediction Error: 404: Employee not found
_______ TestPredictionEndpoints.test_aggregate_prediction_requires_auth _______
test_api.py:78: in test_aggregate_prediction_requires_auth
    assert response.status_code == 401
E   assert 200 == 401
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout call -----------------------------
INFO: Shap explainer type - shap.explainers.PermutationExplainer()
INFO: Shap explainer type - shap.explainers.PermutationExplainer()
___________ TestBayesianEndpoints.test_bayesian_train_requires_auth ___________
test_api.py:112: in test_bayesian_train_requires_auth
    assert response.status_code == 401
E   assert 200 == 401
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout call -----------------------------
Training Progress: 52% - One Year: Model optimized
Training Progress: 56% - One Year: Model evaluated
INFO: Shap explainer type - shap.explainers.PermutationExplainer()
________ TestBayesianEndpoints.test_bayesian_individual_requires_auth _________
test_api.py:120: in test_bayesian_individual_requires_auth
    assert response.status_code == 401
E   assert 500 == 401
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout call -----------------------------
Bayesian prediction error: 404: Employee not found
---------------------------- Captured stderr call -----------------------------
Traceback (most recent call last):
  File "C:\Users\lucev\Downloads\Turnover Program General\Turnover Program v4\backend\app\routers\predictions.py", line 484, in predict_individual_bayesian
    raise HTTPException(status_code=404, detail="Employee not found")
fastapi.exceptions.HTTPException: 404: Employee not found
_________ TestBayesianEndpoints.test_bayesian_aggregate_requires_auth _________
test_api.py:128: in test_bayesian_aggregate_requires_auth
    assert response.status_code == 401
E   assert 200 == 401
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stderr call -----------------------------
\rPermutationExplainer explainer:  24%|\u2588\u2588\u258d       | 73/300 [00:00<?, ?it/s]\n\r  0%|          | 0/1500 [00:00<?, ?it/s]\x1b[A\rPermutationExplainer explainer:  25%|\u2588\u2588\u258c       | 76/300 [00:10<00:14, 15.49it/s]\rPermutationExplainer explainer:  26%|\u2588\u2588\u258c       | 78/300 [00:10<00:37,  5.96it/s]\rPermutationExplainer explainer:  27%|\u2588\u2588\u258b       | 80/300 [00:10<00:30,  7.11it/s]\rPermutationExplainer explainer:  27%|\u2588\u2588\u258b       | 82/300 [00:11<00:29,  7.42it/s]\rPermutationExplainer explainer:  28%|\u2588\u2588\u258a       | 83/300 [00:11<00:29,  7.45it/s]\rPermutationExplainer explainer:  28%|\u2588\u2588\u258a       | 84/300 [00:11<00:28,  7.62it/s]\rPermutationExplainer explainer:  28%|\u2588\u2588\u258a       | 85/300 [00:11<00:30,  7.12it/s]\rPermutationExplainer explainer:  29%|\u2588\u2588\u258a       | 86/300 [00:11<00:30,  7.09it/s]\n\rwarmup:   0%|          | 1/1500 [00:01<41:08,  1.65s/it, 1 steps of size 2.34e+00. acc. prob=0.00]\x1b[A\n\rwarmup:   2%|\u258f         | 26/1500 [00:01<01:11, 20.48it/s, 31 steps of size 3.29e-02. acc. prob=0.72]\x1b[A\rPermutationExplainer explainer:  29%|\u2588\u2588\u2589       | 88/300 [00:11<00:25,  8.46it/s]\n\rwarmup:   4%|\u258e         | 54/1500 [00:01<00:30, 46.94it/s, 15 steps of size 3.09e-02. acc. prob=0.75]\x1b[A\n\rwarmup:   6%|\u258c         | 85/1500 [00:01<00:17, 80.32it/s, 31 steps of size 1.70e-02. acc. prob=0.76]\x1b[A\rPermutationExplainer explainer:  30%|\u2588\u2588\u2588       | 90/300 [00:12<00:22,  9.28it/s]\n\rwarmup:   7%|\u258b         | 110/1500 [00:02<00:13, 106.33it/s, 31 steps of size 2.40e-01. acc. prob=0.77]\x1b[A\rPermutationExplainer explainer:  31%|\u2588\u2588\u2588       | 92/300 [00:12<00:20,  9.98it/s]\n\rwarmup:   9%|\u2589         | 135/1500 [00:02<00:10, 131.73it/s, 31 steps of size 2.62e-01. acc. prob=0.78]\x1b[A\n\rwarmup:  11%|\u2588         | 167/1500 [00:02<00:07, 169.81it/s, 15 steps of size 1.57e-01. acc. prob=0.77]\x1b[A\n\rwarmup:  13%|\u2588\u258e        | 199/1500 [00:02<00:06, 202.20it/s, 15 steps of size 1.75e-01. acc. prob=0.78]\x1b[A\rPermutationExplainer explainer:  31%|\u2588\u2588\u2588\u258f      | 94/300 [00:12<00:21,  9.54it/s]\n\rwarmup:  16%|\u2588\u258c        | 235/1500 [00:02<00:05, 239.93it/s, 31 steps of size 2.46e-01. acc. prob=0.78]\x1b[A\rPermutationExplainer explainer:  32%|\u2588\u2588\u2588\u258f      | 96/300 [00:12<00:20, 10.20it/s]\n\rwarmup:  18%|\u2588\u258a        | 266/1500 [00:02<00:04, 257.53it/s, 63 steps of size 1.66e-01. acc. prob=0.78]\x1b[A\n\rwarmup:  20%|\u2588\u2589        | 297/1500 [00:02<00:04, 250.44it/s, 15 steps of size 3.06e-01. acc. prob=0.78]\x1b[A\rPermutationExplainer explainer:  33%|\u2588\u2588\u2588\u258e      | 98/300 [00:12<00:18, 10.87it/s]\n\rwarmup:  22%|\u2588\u2588\u258f       | 329/1500 [00:02<00:04, 266.87it/s, 31 steps of size 2.74e-01. acc. prob=0.78]\x1b[A\rPermutationExplainer explainer:  33%|\u2588\u2588\u2588\u258e      | 100/300 [00:13<00:18, 11.10it/s]\n\rwarmup:  24%|\u2588\u2588\u258d       | 362/1500 [00:02<00:04, 282.42it/s, 15 steps of size 2.71e-01. acc. prob=0.78]\x1b[A\n\rwarmup:  26%|\u2588\u2588\u258b       | 396/1500 [00:02<00:03, 297.04it/s, 15 steps of size 2.58e-01. acc. prob=0.78]\x1b[A\rPermutationExplainer explainer:  34%|\u2588\u2588\u2588\u258d      | 102/300 [00:13<00:17, 11.13it/s]\n\rwarmup:  29%|\u2588\u2588\u258a       | 430/1500 [00:03<00:03, 306.71it/s, 15 steps of size 1.97e-01. acc. prob=0.79]\x1b[A\n\rwarmup:  31%|\u2588\u2588\u2588       | 462/1500 [00:03<00:03, 310.46it/s, 31 steps of size 2.27e-01. acc. prob=0.78]\x1b[A\rPermutationExplainer explainer:  35%|\u2588\u2588\u2588\u258d      | 104/300 [00:13<00:16, 11.66it/s]
============================== warnings summary ===============================
..\..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\applications.py:18
  C:\Users\lucev\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\applications.py:18: DeprecationWarning: 'HTTP_422_UNPROCESSABLE_ENTITY' is deprecated. Use 'HTTP_422_UNPROCESSABLE_CONTENT' instead.
    from fastapi.exception_handlers import (

..\..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\applications.py:30
  C:\Users\lucev\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\applications.py:30: DeprecationWarning: 'HTTP_422_UNPROCESSABLE_ENTITY' is deprecated. Use 'HTTP_422_UNPROCESSABLE_CONTENT' instead.
    from fastapi.openapi.utils import get_openapi

backend/tests/test_api.py::TestHealthEndpoints::test_root_endpoint
  C:\Users\lucev\Downloads\Turnover Program General\Turnover Program v4\backend\app\routers\motivation.py:20: DeprecationWarning:
  
  
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED test_api.py::TestTrainingEndpoints::test_train_requires_auth - assert ...
FAILED test_api.py::TestPredictionEndpoints::test_individual_prediction_requires_auth
FAILED test_api.py::TestPredictionEndpoints::test_aggregate_prediction_requires_auth
FAILED test_api.py::TestBayesianEndpoints::test_bayesian_train_requires_auth
FAILED test_api.py::TestBayesianEndpoints::test_bayesian_individual_requires_auth
FAILED test_api.py::TestBayesianEndpoints::test_bayesian_aggregate_requires_auth
ERROR test_api.py::TestTrainingEndpoints::test_train_with_auth
ERROR test_api.py::TestPredictionEndpoints::test_individual_prediction_with_auth
============= 6 failed, 6 passed, 3 warnings, 2 errors in 30.25s ==============
